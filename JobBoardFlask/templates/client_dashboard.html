{% extends "base.html" %}

{% block title %}My Jobs - JobMarket{% endblock %}

{% block content %}
<div class="page-header">
    <h1>My Jobs</h1>
    <p>Manage your job postings and view proposals</p>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
    <div class="action-bar">
        <div></div>
        <a href="{{ url_for('post_job') }}" class="btn">+ Post a Job</a>
    </div>
    
    <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #d5e0d5; text-align: center;">
        <p style="color: #5e6d55; margin-bottom: 8px;">Account Balance</p>
        <h2 style="font-size: 32px; color: #14a800;">${{ "%.2f"|format(balance) }}</h2>
        <a href="{{ url_for('wallet') }}" class="btn btn-outline btn-small" style="margin-top: 12px;">View Wallet</a>
    </div>
</div>

<!-- Active Contracts -->
{% if contracts %}
    <div style="margin-bottom: 40px;">
        <h2 style="margin-bottom: 24px;">Active Contracts</h2>
        <div class="jobs-grid">
            {% for contract in contracts %}
                <div class="job-card">
                    <h3 class="job-title">{{ contract['job_title'] }}</h3>
                    <p style="margin-bottom: 16px;">
                        <strong>Freelancer:</strong> 
                        <a href="{{ url_for('view_profile', user_id=contract['freelancer_id']) }}">{{ contract['freelancer_name'] }}</a>
                    </p>
                    <div class="job-footer">
                        <span><strong>Amount:</strong> ${{ contract['amount'] }}</span>
                        <a href="{{ url_for('message_thread', other_user_id=contract['freelancer_id']) }}" class="btn btn-small">Message</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

<!-- Posted Jobs -->
<h2 style="margin-bottom: 24px;">Posted Jobs</h2>

{% if jobs %}
    <div class="jobs-grid">
        {% for job in jobs %}
        <div class="job-card">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <h3 class="job-title">
                    <a href="{{ url_for('view_job', job_id=job['id']) }}">{{ job['title'] }}</a>
                </h3>
                <span class="stats-badge" style="{% if job['status'] == 'open' %}background: #e7f6e4;{% elif job['status'] == 'in_progress' %}background: #fff3cd; color: #856404;{% else %}background: #f9faf9; color: #5e6d55;{% endif %}">
                    {{ job['status'].replace('_', ' ').title() }}
                </span>
            </div>
            <div class="job-meta">
                <span class="job-meta-item">Posted {{ job['created_at'] }}</span>
                {% if job['category_name'] %}
                    <span class="stats-badge">{{ job['category_name'] }}</span>
                {% endif %}
                <span class="stats-badge">{{ job['proposal_count'] }} proposal{{ 's' if job['proposal_count'] != 1 else '' }}</span>
            </div>
            <p class="job-description">{{ job['description'][:150] }}...</p>
            <div class="job-footer">
                {% if job['budget'] %}
                    <span><strong>Budget:</strong> ${{ job['budget'] }}</span>
                {% endif %}
                <a href="{{ url_for('view_job', job_id=job['id']) }}" class="btn btn-small">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <h3>You haven't posted any jobs yet</h3>
        <p>Post your first job to start receiving proposals from talented freelancers</p>
        <a href="{{ url_for('post_job') }}" class="btn btn-large">Post a Job</a>
    </div>
{% endif %}
{% endblock %}
